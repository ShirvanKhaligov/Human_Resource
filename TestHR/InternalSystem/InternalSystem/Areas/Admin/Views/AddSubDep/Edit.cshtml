@model DeptAndSubDeptVM

@{
    ViewData["Title"] = "Edit";
}

<div class="content-wrapper" style="color: black; background-color: rgb(255, 255, 255); min-height: 194px;">
    <div class="container-fluid">
        <br>
        <br>
        <a asp-area="InternalHR" asp-controller="SubDepartment" asp-action="Index" class="col-md-2 btn btn-primary "><i class="fas fa-long-arrow-alt-left"></i>  Geri</a>
        <div class=" ">
            <br><br>
            <form method="post">
                <div class="form-group row ml-md-4">
                    <label for="departmentName" class="col-md-2">Şirkətin adı:</label>
                    <div class="form-group col-md-5">
                        <select onchange="selectCompany()" id="companySelectedId" name="compEditId" class="form-control">
                            <option disabled>Seçin</option>
                            @foreach (var company in Model.Companiess)
                            {
                                if (Model.CompaniesId == company.Id)
                                {
                                    <option selected value="@company.Id">@company.Name</option>
                                }
                                else
                                {
                                    <option value="@company.Id">@company.Name</option>
                                }
                            }
                        </select>
                        @if (ViewData["error_compName"] != null)
                        {
                            <span class="text-danger">@ViewData["error_compName"]</span>
                        }
                    </div>
                </div>
                <div class="form-group row ml-md-4">
                    <label for="departmentName" class="col-md-2">Şöbənin adı:</label>
                    <div class="form-group col-md-5" id="DepartmentSelectDiv">
                        <select name="DeptEditId" class="form-control">
                            <option disabled>Seçin</option>
                            @foreach (var department in Model.DepartmentToCompanies)
                            {
                                if (Model.DepartmentId == department.DepartmentId)
                                {
                                    <option selected value="@department.DepartmentId">@department.Department.Name</option>
                                }
                                else
                                {
                                    <option value="@department.DepartmentId">@department.Department.Name</option>
                                }
                            }
                        </select>
                        @if (ViewData["error_deptName"] != null)
                        {
                            <span class="text-danger">@ViewData["error_deptName"]</span>
                        }
                    </div>
                </div>
                <div class="form-group row ml-md-4">
                    <label asp-for="@Model.SubDepartment.Name" for="subdepartmentName" class="col-md-2">Alt şöbənin adı:</label>
                    <div class="col-md-5">
                        <input required asp-for="@Model.SubDepartment.Name" type="text" style="height: 35px;" class="form-control" id="departmentName">
                        <span asp-validation-for="@Model.SubDepartment.Name" class="text-danger"></span>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4 mx-auto">
                        <input style="width: 300px;" class="btn btn-success" type="submit" value="Əlavə et" />
                    </div>
                </div>
            </form>
        </div>
    </div>
    <!--content-wrapper-->
</div>

@section scripts{
    <script>
        function selectCompany() {
            var e = document.getElementById("companySelectedId");
              var selectedCompany = e.options[e.selectedIndex].value;
            console.log(selectedCompany);
            $.ajax({
                type: "get",
                url: "@Url.Action("GetDepartment","SubDepartment")",
                data: { Id: selectedCompany },
                success: function (respoonse) {
                    $("#DepartmentSelectDiv").html(respoonse)
                    console.log("success")
                    console.log(respoonse)
                },
                error: function (response) {
                    console.error("error - suceess")
                    console.error(respoonse)
                }

            })
          }
    </script>
}

