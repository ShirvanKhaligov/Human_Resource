@model IEnumerable<ContactBetweenDepartmentsInbox>
@{
    ViewData["Title"] = "Inbox";
}
<style>


    .btn-success {
        background-color: #2590d3 !important;
        border-color: #2590d3 !important;
    }

    .btn-primary {
        background-color: #2590d3 !important;
        border-color: #2590d3 !important;
    }

    .btn-warning {
        background-color: #2590d3 !important;
        border-color: #2590d3 !important;
    }

    .btn-danger {
        background-color: #2590d3 !important;
        border-color: #2590d3 !important;
    }
</style>
<div class="content-wrapper" style="background:#e0e0e0">
    <div class="content-header">
        <div class="container-fluid">
            <div class="row mb-2">
                <div class="col-sm-6">
                    <h1 class="m-0 text-dark"></h1>
                </div><!-- /.col -->
                <div class="col-sm-6">
                    <ol class="breadcrumb float-sm-right">
                        <li class="breadcrumb-item"><a asp-area="Employee" asp-controller="Dashboard" asp-action="Index">Dashboard</a></li>
                        <li class="breadcrumb-item active">Gələnlər</li>
                    </ol>
                </div><!-- /.col -->
            </div><!-- /.row -->
        </div><!-- /.container-fluid -->
    </div>
    <div class="">
            <div class="card-body">
                <div class="row">
                    <div style="height:600px;overflow-y:scroll;" class="col-md-12 mx-auto" id="inboxtableDiv">
                        <table class="table table-responsive-md" style="color:black;">
                            <thead style="text-align: center" class="All_Index_View_Change_Thead">
                                <tr class="All_Index_View_Change_Tr">
                                    <th scope="col">Sıra №</th>
                                    <th scope="col">Kimdən</th>
                                    <th scope="col"> Mövzu</th>
                                    <th scope="col"> Mesaj</th>
                                    <th scope="col"> Tarix</th>
                                    <th scope="col"> Status</th>
                                    <th scope="col"> Sil</th>
                                </tr>
                            </thead>
                            <tbody style="text-align: center;background: white;" class="">
                                @if (Model.Count() != 0)
                                {
                                    int count = 1;
                                    foreach (var inbox in Model)
                                    {
                                        @if (inbox.isRead != false)
                                        {
                                            <tr style="cursor:pointer;">
                                                <th onclick="openAnswerModal(@inbox.Id)" scope="row">@count</th>
                                                <td onclick="openAnswerModal(@inbox.Id)">@inbox.From</td>
                                                <td onclick="openAnswerModal(@inbox.Id)">@inbox.Subject</td>
                                                <td onclick="openAnswerModal(@inbox.Id)">@inbox.Message</td>
                                                <td onclick="openAnswerModal(@inbox.Id)">@inbox.CreatedDate</td>
                                                <td class="text-white">◉</td>
                                                <td>
                                                    <a onclick="deleteConfirmation(@inbox.Id)" class="btn btn-danger">Sil</a>
                                                </td>
                                            </tr>
                                        }
                                        else
                                        {
                                            <tr style="font-weight:bold">
                                                <th onclick="openAnswerModal(@inbox.Id)" scope="row">@count</th>
                                                <td onclick="openAnswerModal(@inbox.Id)">@inbox.From</td>
                                                <td onclick="openAnswerModal(@inbox.Id)">@inbox.Subject</td>
                                                <td onclick="openAnswerModal(@inbox.Id)">@inbox.Message</td>
                                                <td onclick="openAnswerModal(@inbox.Id)">@inbox.CreatedDate</td>
                                                <td class="text-green">◉</td>

                                                <td>
                                                    <a onclick="deleteConfirmation(@inbox.Id)" class="btn btn-danger">Sil</a>
                                                </td>
                                            </tr>
                                        }

                                        count++;
                                    }
                                }
                                else
                                {
                                    <tr>
                                        <td>0</td>
                                        <td>Boş</td>
                                        <td>Boş</td>
                                        <td>Boş</td>
                                        <td>Boş</td>
                                        <td>Boş</td>
                                        <td>Boş</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
    </div>

    <!--content-wrapper-->
</div>
<section class="modalSection">
    <div class="modal" tabindex="-1" role="dialog" id="inboxModal">
        <div class="modal-dialog" role="document">
            <div class="modal-content" id="intoIntoModal">

            </div>
        </div>
    </div>
</section>
@section scripts{
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/2.1.2/sweetalert.min.js"></script>
    <script>
        function deleteConfirmation(Id) {
            swal({
                title: "Silməyə əminsiniz?",
                icon: "warning",
                buttons: true,
                dangerMode: true,
            })
                .then((willDelete) => {
                    if (willDelete) {
                        $.ajax({
                        type: 'post',
                        url: '@Url.Action("DeleteMsjFromInbox", "DepartmentContact")',
                        data: { msjId: Id },
                           success: function (response) {
                               $("#inboxtableDiv").html(response)
                               if (willDelete) {
                                   swal("Mesaj Silindi", {
                                       icon: "success",
                                   });
                               }
                        },
                        error: function (response) {
                            console.error(response)
                        }
                     })
                    }
                });
        }


        function openAnswerModal(Id) {
                      $.ajax({
                        type: 'get',
                        url: '@Url.Action("GetSingleInboxMessage", "DepartmentContact")',
                        data: { msjId: Id },
                           success: function (response) {
                               $("#inboxModal").modal('show')
                               $("#intoIntoModal").html(response)
                        },
                        error: function (response) {
                            console.error(response)
                        }
                     })
        }


        function closeModal() {
            $("#inboxModal").modal('hide')
            $.ajax({
              type: 'get',
              url: '@Url.Action("loadInbox", "DepartmentContact")',
                 success: function (response) {
                     $("#inboxtableDiv").html(response)
              },
              error: function (response) {
                  console.error(response)
              }
           })
        }


        function sentAnswerMessage(Id) {
           var answerId = $("#answerMesajId").val()
           $.ajax({
              type: 'post',
              url: '@Url.Action("AnswerMessage", "DepartmentContact")',
               data: {
                   from: Id,
                   answer:answerId,
               },
                 success: function (response) {
                     $("#inboxtableDiv").html(response)
                     $("#inboxModal").modal('hide')
                     swal({
                         title: "Uğurlu!",
                         icon: "success",
                         button: "Bağla!",
                     });
              },
              error: function (response) {
                  console.error(response)
              }
           })
        }

    </script>

}
